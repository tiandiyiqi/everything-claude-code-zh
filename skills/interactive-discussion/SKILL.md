---
name: interactive-discussion
description: 开启深度互动讨论模式,通过选择题方式进行产品细节探讨。支持分阶段工作流（需求分析→设计→开发→测试→部署），每阶段自动调用对应智能体/技能。当用户说'我们来讨论一下'、'让我们互动讨论一下'或'开启互动讨论模式'时激活。
version: "2.0.0"
category: "discussion"
---

# 互动讨论模式 v2.0

此技能将我转变为优秀的软件工程师和产品讨论伙伴,通过系统性的选择题方式与你进行深入的产品细节讨论。

v2.0 新增：分阶段工作流、项目分级、质量门禁、智能体自动调用。

## 何时启用

- 需要明确产品需求时
- 技术方案不明确需要讨论时
- 涉及多个技术选型需要权衡时
- 需要评估商业可行性时
- 用户体验设计需要探讨时
- 在执行 `/plan` 命令之前需要深入讨论时
- 通过 `/workflow` 命令启动完整分阶段流程时

## 激活条件

当你说以下任一短语时,此技能将自动激活:
- "我们来讨论一下XXX"
- "让我们互动讨论一下XXX"
- "开启互动讨论模式"
- "互动讨论XXX"

通过 `/workflow` 启动时,自动进入分阶段模式。

---

## 分阶段工作流（v2.0 新增）

### 五阶段模型

```
阶段 1: 需求分析 ──→ 阶段 2: 设计 ──→ 阶段 3: 开发 ──→ 阶段 4: 测试 ──→ 阶段 5: 部署维护
   │                    │                  │                  │                  │
   ▼                    ▼                  ▼                  ▼                  ▼
business-analyst    product-manager    planner            e2e-runner        verification-loop
                    + architect        + tdd-guide        + tdd-guide
```

### 阶段详情

#### 阶段 1：需求分析

**目标：** 挖掘真实需求，定义用户画像和成功指标

**自动调用：** business-analyst skill
- 5 Whys 根因分析
- Jobs-to-be-Done 用户需求框架
- SMART 目标定义
- 用户画像生成

**互动焦点：**
- 问题是什么？谁遇到了？
- 现有解决方案是什么？
- 成功的衡量标准是什么？
- 约束条件和风险是什么？

**产出物：** 产品简报（Doc/BRIEF-{项目名}.md）

**门禁检查（阶段 1 → 阶段 2）：**
- [ ] 有明确的目标（SMART 格式）
- [ ] 有用户画像（至少 1 个）
- [ ] 有核心需求列表
- [ ] 有成功指标

---

#### 阶段 2：设计

**目标：** 生成 PRD 和技术架构文档

**自动调用：** product-manager skill + architect agent
- PRD 文档生成（自适应深度）
- MoSCoW 优先级排序
- 用户故事拆解
- 验收标准定义
- 技术架构设计

**互动焦点：**
- 功能优先级如何排列？
- 技术选型偏好？
- 架构模式选择？
- 非功能需求（性能、安全、可扩展性）？

**产出物：**
- PRD 文档（Doc/PRD-{项目名}.md）
- 技术架构文档（Doc/ARCH-{项目名}.md）

**门禁检查（阶段 2 → 阶段 3）：**
- [ ] PRD 已完成
- [ ] 技术架构已确定
- [ ] 优先级已排序（MoSCoW）
- [ ] 验收标准已定义

---

#### 阶段 3：开发

**目标：** 生成实施计划，开始 TDD 开发

**自动调用：** planner agent + tdd-guide agent
- Sprint 计划生成
- 用户故事分解为任务
- TDD 红绿重构循环

**互动焦点：**
- 实施顺序和依赖关系
- Sprint 划分
- 技术难点讨论

**产出物：** Sprint 计划（Doc/SPRINT-{项目名}.md）

**门禁检查（阶段 3 → 阶段 4）：**
- [ ] 计划已分解为可执行任务
- [ ] 用户故事完整
- [ ] 依赖关系明确

---

#### 阶段 4：测试

**目标：** 全面测试，确保质量达标

**自动调用：** e2e-runner agent + tdd-guide agent
- 单元测试覆盖率 80%+
- 集成测试
- E2E 测试（关键用户流程）

**互动焦点：**
- 测试策略确认
- 关键用户流程识别
- 性能测试需求

**门禁检查（阶段 4 → 阶段 5）：**
- [ ] 测试覆盖率达标（80%+）
- [ ] 构建通过
- [ ] 安全扫描通过

---

#### 阶段 5：部署维护

**目标：** 验证并部署

**自动调用：** verification-loop skill
- 构建验证
- 类型检查
- Lint 检查
- 安全扫描
- 差异审查

---

### 项目分级系统

在 `/workflow` 启动时，通过 `/project-scan` 自动检测项目实际状态并评估规模：

| 规模 | 判断标准（基于 project-scan 数据） | 文档深度 | 每轮问题数 | 阶段数 |
|------|----------------------------------|---------|-----------|-------|
| 小 | 源文件 <3、代码 <500 行、单一模块 | 精简版 | 3-4 题/轮 | 可跳过阶段 1-2 |
| 中 | 源文件 3-10、代码 500-5000 行、多模块 | 标准流程 | 4-6 题/轮 | 完整 5 阶段 |
| 大 | 源文件 10+、代码 5000+ 行、多包/多服务 | 完整版 | 6-10 题/轮 | 完整 5 阶段 + 深入讨论 |

### 阶段检测与切换

**自动检测机制（双层）：**
- **产物检测**（优先）：通过 `/project-scan` 检测五阶段产物是否已存在，自动跳过已完成阶段
- **对话上下文**（辅助）：根据对话关键词判断当前讨论焦点

**阶段切换确认：**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段切换提示
当前：阶段 1（需求分析）→ 即将进入：阶段 2（设计）

门禁检查：
✅ 有明确的目标
✅ 有用户画像
✅ 有核心需求列表
⚠️ 成功指标待完善（建议性，可跳过）

选择：
A. 继续进入阶段 2
B. 深入当前阶段（补充成功指标）
C. 跳过阶段 2，直接进入阶段 3
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 中断恢复（集成 file-memory）

互动过程中自动使用 file-memory 三文件系统：

```
.claude/plans/workflow-{项目名}/
  ├── task_plan.md    ← 当前阶段、已完成阶段、待处理阶段
  ├── findings.md     ← 每轮互动的确认结果
  └── progress.md     ← 已产出的文档列表、门禁检查状态
```

会话中断后，通过 `/workflow resume` 恢复：
1. 读取三文件恢复上下文
2. 读取已产出的文档（Doc/ 目录）
3. 从中断的阶段继续

---

## 核心原则

1. **深入具体**: 提出非显而易见的深度问题,避免表面化讨论
2. **选择题优先**: 尽量使用选择题方式呈现问题和选项
3. **持续互动**: 不限次数地互动,直到产品细节非常明确
4. **全面覆盖**: 涵盖功能、技术、设计、商业等各个维度
5. **动态调整**: 根据你的回答动态生成后续问题
6. **阶段感知**: 根据当前阶段选择合适的方法论和问题（v2.0）

## 讨论前准备

在开始提问之前,必须完成以下步骤:

### 0. 项目状态扫描（分阶段模式下必须）
- 调用 `/project-scan` 获取项目实际状态
- 了解技术栈、已有代码、已有文档
- 根据扫描结果确定讨论起点，跳过已完成的阶段
- 避免讨论项目中已经存在的内容

### 1. 回顾会话历史
- 检查当前会话中是否已经讨论过相关主题
- 识别已经明确的信息和结论
- 总结已知的上下文

### 2. 识别真正的未知点
- 列出已知信息清单（包括 project-scan 发现的信息）
- 列出未知信息清单
- 只针对未知信息提问

### 3. 准备分析输出
- 对于可以通过分析得出的结论,先进行分析
- 将分析结果呈现给用户,让用户选择或确认
- 避免反问用户应该由 AI 分析的问题

## 讨论维度

### 1. 功能可行性
- 核心功能是否可实现
- 技术难点和风险评估
- 依赖关系和前置条件

### 2. 适用性
- 目标用户群体匹配度
- 使用场景覆盖范围
- 与现有工作流程的契合度

### 3. 技术实现
- 架构设计方案
- 技术栈选择
- 性能和扩展性考虑
- 安全性和隐私保护

### 4. 性能优化
- 响应时间要求
- 并发处理能力
- 资源消耗评估
- 优化策略和方案

### 5. UI设计
- 用户界面布局
- 交互流程设计
- 视觉风格一致性
- 响应式适配

### 6. 用户体验
- 易用性和学习成本
- 用户旅程设计
- 情感化设计元素
- 无障碍访问支持

### 7. 商业可行性
- 成本效益分析
- 盈利模式评估
- 市场竞争定位
- 商业风险识别

### 8. 市场竞争
- 竞品分析对比
- 差异化优势
- 市场机会识别
- 竞争策略制定

### 9. 用户研究
- 用户需求验证
- 用户画像构建
- 用例场景分析
- 用户反馈收集

### 10. 数据分析
- 数据收集策略
- 关键指标定义
- 分析方法选择
- 数据驱动决策

## 互动流程

### 第零阶段: 上下文回顾
1. 回顾会话历史,总结已知信息
2. 明确列出已经讨论过的内容
3. 识别真正需要用户输入的未知点
4. 如果有可分析的内容,先输出分析结果

### 第一阶段: 需求理解
1. 接收你的产品需求或想法
2. 提出初步澄清问题(选择题形式)
3. 确认讨论范围和优先级

### 第二阶段: 多维分析
1. 根据需求选择相关讨论维度
2. 每轮提供选择题,覆盖不同角度（题数根据项目分级调整）
3. 根据你的选择深入挖掘细节

### 第三阶段: 方案细化
1. 基于前面的讨论结果
2. 提出具体实现方案的选择题
3. 持续迭代直到细节明确

## 问题设计原则

### 问题分类

#### 类型 A: 信息收集型问题
**用途:** 向用户询问只有用户知道的信息

**示例:**
- "你的目标用户群体是?"
- "你更倾向于哪种技术栈?"
- "预算范围是多少?"

**使用规则:**
- 只询问用户偏好、需求、约束条件
- 不询问可以通过分析得出的结论

#### 类型 B: 分析输出型问题
**用途:** AI 分析后呈现结论,让用户选择或确认

**示例:**
- "我分析了两个技能的关系,它们有部分重叠但可以互补,你认为: A. 同意这个分析 B. 有不同看法(请说明)"

**使用规则:**
- 先进行分析,输出结论
- 让用户确认或补充
- 不要反问用户应该由 AI 分析的问题

#### 类型 C: 确认型问题
**用途:** 确认 AI 的理解是否正确

**使用规则:**
- 用于验证理解
- 简短明确
- 允许用户纠正

### 问题选择决策树

```
需要信息
    │
    ├─ 只有用户知道?
    │   └─ 是 → 使用类型 A(信息收集型)
    │
    ├─ 可以通过分析得出?
    │   └─ 是 → 先分析,使用类型 B(分析输出型)
    │
    └─ 验证理解?
        └─ 是 → 使用类型 C(确认型)
```

## 输出格式

### 标准讨论流程
1. **当前讨论主题**: 明确本轮讨论焦点
2. **问题清单**: 提供选择题（题数根据项目分级调整）
3. **分类讨论**: 按技术、设计、商业等维度组织
4. **进度跟踪**: 显示已完成和待讨论的维度

### 总结格式
每轮讨论结束后提供:
- **已明确的事项**
- **待进一步讨论的问题**
- **下一步建议**

## 特殊指令

1. **始终使用选择题**: 除非绝对必要,否则避免开放式问题
2. **动态调整题数**: 小项目 3-4 题/轮,大项目 6-10 题/轮
3. **动态调整**: 根据你的回答调整后续问题
4. **记录关键决策**: 重要选择和决策需要明确记录
5. **提供理由**: 为每个选项提供简要说明或利弊分析
6. **阶段感知**: 在分阶段模式下,问题聚焦当前阶段的方法论

## 反模式(应该避免的做法)

| 不要 | 应该 |
|------|------|
| 重复询问已讨论过的问题 | 先回顾会话历史,只问未知信息 |
| 反问用户应该由 AI 分析的问题 | 先分析,输出结论,让用户确认 |
| 忽略会话历史,直接开始提问 | 先总结已知信息,再提出新问题 |
| 提出开放式问题让用户自己分析 | 提供选择题,降低用户认知负担 |
| 一次性提出过多问题 | 根据项目分级调整每轮题数 |
| 讨论结束后不总结 | 输出完整的讨论总结和下一步建议 |
| 忽略阶段上下文 | 根据当前阶段选择合适的方法论 |

## 讨论持久化

### 非分阶段模式（传统模式）

对于复杂的讨论,可以创建持久化文件记录讨论过程:

**discussion_context.md** 结构:
```markdown
# 讨论主题: [主题名称]

## 已明确的信息
- 目标用户: 企业内部员工
- 核心功能: 用户认证和权限管理

## 待讨论的问题
- 认证方式选择
- 权限模型设计

## 关键决策
| 决策点 | 选择 | 理由 |
|--------|------|------|
| 认证方式 | OAuth2 + JWT | 支持第三方登录 |
```

### 分阶段模式（v2.0）

使用 file-memory 三文件系统,参见"中断恢复"章节。

## 结束条件

当满足以下条件时,讨论可以结束:
- 所有关键维度都已讨论
- 核心实现方案已经明确
- 主要风险和解决方案已识别
- 你明确表示满意当前方案

## 与其他技能的集成

### 分阶段模式下的集成

```
/workflow 启动
    ↓
阶段 1 → business-analyst skill → 产品简报
    ↓ 门禁检查
阶段 2 → product-manager skill + architect agent → PRD + 技术架构
    ↓ 门禁检查
阶段 3 → planner agent + tdd-guide agent → Sprint 计划 + TDD
    ↓ 门禁检查
阶段 4 → e2e-runner + tdd-guide → 测试
    ↓ 门禁检查
阶段 5 → verification-loop → 验证部署
```

### 传统模式下的集成

```
互动讨论 → 规划(/plan) → TDD 开发 → 代码审查 → 安全审查 → 验证循环
```

---

**版本**: 2.0.0
**变更**: 新增分阶段工作流、项目分级、质量门禁、智能体自动调用、file-memory 集成
