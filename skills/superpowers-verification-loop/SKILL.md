---
name: superpowers-verification-loop
description: 验证门函数 - 在声称工作完成、修复或通过之前使用，提交或创建 PR 前必须运行验证命令并确认输出；证据优先于断言
version: 1.0.0
category: verification
---

# 完成前验证

## 概述

在没有验证的情况下声称工作完成是不诚实，而不是高效。

**核心原则：** 证据优先于声明，始终如此。

**违反此规则的字面意义就是违反此规则的精神。**

## 铁律

```
没有新鲜验证证据就不能声称完成
```

如果你没有在此消息中运行验证命令，就不能声称它通过。

## 验证门函数

```
在声称任何状态或表达满意之前：

1. 识别：什么命令证明这个声明？
2. 运行：执行完整命令（新鲜、完整）
3. 读取：完整输出、检查退出码、计数失败
4. 验证：输出是否确认声明？
   - 如果否：陈述实际状态及证据
   - 如果是：陈述声明及证据
5. 仅在此后：做出声明

跳过任何步骤 = 撒谎，而不是验证
```

## 常见失败

| 声明 | 需要 | 不充分 |
|------|------|--------|
| 测试通过 | 测试命令输出：0 个失败 | 之前的运行、"应该通过" |
| Linter 干净 | Linter 输出：0 个错误 | 部分检查、推断 |
| 构建成功 | 构建命令：退出 0 | Linter 通过、日志看起来不错 |
| Bug 已修复 | 测试原始症状：通过 | 代码已更改、假设已修复 |
| 回归测试有效 | 红绿循环已验证 | 测试通过一次 |
| 智能体完成 | VCS diff 显示更改 | 智能体报告"成功" |
| 需求已满足 | 逐行检查清单 | 测试通过 |

## 红旗警告 - 停止

- 使用"应该"、"可能"、"似乎"
- 在验证前表达满意（"太好了！"、"完美！"、"完成！"等）
- 即将提交/推送/PR 而没有验证
- 信任智能体成功报告
- 依赖部分验证
- 想着"就这一次"
- 疲倦并想结束工作
- **任何暗示成功而没有运行验证的措辞**

## 防止合理化

| 借口 | 现实 |
|------|------|
| "现在应该可以了" | 运行验证 |
| "我很有信心" | 信心 ≠ 证据 |
| "就这一次" | 没有例外 |
| "Linter 通过了" | Linter ≠ 编译器 |
| "智能体说成功" | 独立验证 |
| "我累了" | 疲劳 ≠ 借口 |
| "部分检查就够了" | 部分证明不了什么 |
| "不同措辞所以规则不适用" | 精神高于字面 |

## 关键模式

**测试：**
```
✅ [运行测试命令] [看到：34/34 通过] "所有测试通过"
❌ "现在应该通过" / "看起来正确"
```

**回归测试（TDD 红绿）：**
```
✅ 编写 → 运行（通过）→ 还原修复 → 运行（必须失败）→ 恢复 → 运行（通过）
❌ "我已经写了回归测试"（没有红绿验证）
```

**构建：**
```
✅ [运行构建] [看到：退出 0] "构建通过"
❌ "Linter 通过了"（linter 不检查编译）
```

**需求：**
```
✅ 重新阅读计划 → 创建检查清单 → 验证每项 → 报告差距或完成
❌ "测试通过，阶段完成"
```

**智能体委派：**
```
✅ 智能体报告成功 → 检查 VCS diff → 验证更改 → 报告实际状态
❌ 信任智能体报告
```

## 为什么这很重要

来自 24 个失败记忆：
- 用户说"我不相信你" - 信任破裂
- 未定义的函数被发布 - 会崩溃
- 缺失的需求被发布 - 不完整的功能
- 浪费时间在虚假完成 → 重定向 → 返工
- 违反："诚实是核心价值。如果你撒谎，你会被替换。"

## 何时应用

**始终在以下之前：**
- 任何成功/完成声明的变体
- 任何满意的表达
- 任何关于工作状态的积极陈述
- 提交、PR 创建、任务完成
- 移至下一个任务
- 委派给智能体

**规则适用于：**
- 确切短语
- 释义和同义词
- 成功的暗示
- 任何暗示完成/正确性的沟通

## 底线

**验证没有捷径。**

运行命令。阅读输出。然后声称结果。

这是不可协商的。

## 集成

**与其他技能配合：**
- **superpowers-systematic-debugging** - 阶段 4 验证修复有效
- **superpowers-subagent-execution** - 每个任务完成后验证
- **tdd-workflow** - 红绿重构循环的验证

**与现有功能集成：**
- **/verify** 命令 - 使用此技能的原则
- **verification-loop** skill - 增强版本

## 参考

参见 helpers.md#验证报告模板 了解标准化验证报告格式
参见 helpers.md#通用验证六阶段 了解完整验证流程
