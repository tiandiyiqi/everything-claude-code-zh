# 分阶段工作流（Workflow）命令

启动完整的分阶段项目工作流：需求分析 → 设计 → 开发 → 测试 → 部署维护。

## 用法

```
/workflow                    — 启动新项目工作流
/workflow resume             — 恢复中断的工作流
/workflow status             — 查看当前工作流状态
/workflow --phase 2          — 从指定阶段开始
/workflow --level 大         — 指定项目规模（小/中/大）
```

## 指令（Instructions）

### 启动流程

1. **项目分级评估**
   - 询问用户项目描述
   - 自动评估项目规模（小/中/大）
   - 向用户确认分级结果

2. **初始化 file-memory**
   - 在 `.claude/plans/workflow-{项目名}/` 创建三文件
   - 记录项目名称、分级、启动时间

3. **进入阶段 1（需求分析）**
   - 调用 business-analyst skill
   - 使用 5 Whys、JTBD、SMART 方法论
   - 产出：产品简报（Doc/BRIEF-{项目名}.md）

### 阶段切换

每个阶段结束时：
1. 执行门禁检查（建议性）
2. 向用户展示检查结果
3. 提供选项：继续 / 深入 / 跳过

### 五阶段详情

| 阶段 | 名称 | 调用的智能体/技能 | 产出物 |
|------|------|------------------|--------|
| 1 | 需求分析 | business-analyst | Doc/BRIEF-{项目名}.md |
| 2 | 设计 | product-manager + architect | Doc/PRD-{项目名}.md + Doc/ARCH-{项目名}.md |
| 3 | 开发 | planner + tdd-guide | Doc/SPRINT-{项目名}.md + 代码 |
| 4 | 测试 | e2e-runner + tdd-guide | 测试报告 |
| 5 | 部署维护 | verification-loop | 验证报告 |

### 门禁检查内容

**阶段 1 → 2（需求完整性）：**
- 有明确的目标（SMART 格式）
- 有用户画像
- 有核心需求列表
- 有成功指标

**阶段 2 → 3（设计完整性）：**
- PRD 已完成
- 技术架构已确定
- 优先级已排序
- 验收标准已定义

**阶段 3 → 4（计划完整性）：**
- 计划已分解为可执行任务
- 用户故事完整
- 依赖关系明确

**阶段 4 → 5（质量达标）：**
- 测试覆盖率达标（80%+）
- 构建通过
- 安全扫描通过

### 恢复流程

执行 `/workflow resume` 时：
1. 读取 `.claude/plans/workflow-*/` 下的三文件
2. 读取 Doc/ 目录下已产出的文档
3. 展示当前状态和进度
4. 从中断的阶段继续

## 项目分级参考

| 规模 | 判断标准 | 文档深度 | 每轮问题数 |
|------|---------|---------|-----------|
| 小 | 单一功能、<3 文件、<1 天 | 精简版 | 3-4 题 |
| 中 | 多模块、3-10 文件、数天 | 标准 | 4-6 题 |
| 大 | 多团队、10+ 文件、周级 | 完整版 | 6-10 题 |

## 图表格式

- 复杂图表（架构图、序列图）：使用 Mermaid 语法
- 简单流程：使用 ASCII 框图

## 注意事项

- 门禁检查是建议性的，用户可以选择跳过
- 每个阶段开始时提示用户可以跳过或深入
- 所有文档输出到 Doc/ 目录
- 使用 file-memory 确保中断可恢复
- 小项目可以跳过阶段 1-2，直接从阶段 3 开始
